<section id="gallery" class="gallery">
  <div class="container">
    <header class="gallery__header">
      <h2 class="gallery__title">Gallery</h2>
      <h3 class="gallery__tagline">Moments from our Yacht Experiences</h3>
      <p class="gallery__description">Tap any photo or video to view in full.</p>
    </header>

    <!-- ✅ Modern responsive grid (fast) -->
    <div class="grid" role="list">
      <button
        *ngFor="let item of items()"
        class="tile"
        type="button"
        role="listitem"
        (click)="open(item)"
        [attr.aria-label]="item.kind === 'image' ? item.alt : item.title"
      >
        <img
          class="thumb"
          [src]="item.thumbUrl"
          [alt]="item.kind === 'image' ? item.alt : item.title"
          loading="lazy"
          decoding="async"
        />

        <span class="chip" *ngIf="item.kind === 'video'">Video</span>
        <span class="fade"></span>
      </button>
    </div>

    <div class="gallery-footer">
      <button class="btn primary large" type="button" (click)="seeMore()">
        See More Photos &amp; Videos
      </button>
    </div>

    <!-- ✅ Lightbox modal -->
    <div class="modal-backdrop" *ngIf="isOpen()"></div>

    <div
      class="modal"
      *ngIf="isOpen()"
      role="dialog"
      aria-modal="true"
      (click)="close()"
    >
      <div
        class="modal-shell"
        (click)="stopPropagation($event)"
        (touchstart)="onTouchStart($event)"
        (touchend)="onTouchEnd($event)"
      >
        <div class="modal-topbar">
          <div class="modal-meta">
            <!-- <span class="modal-counter">{{ counterText() }}</span>
            <span class="modal-title" *ngIf="activeItem() as active">
              {{ active.kind === 'image' ? active.alt : active.title }}
            </span> -->
          </div>

          <button class="icon-btn close" type="button" (click)="close()" aria-label="Close">
            <span aria-hidden="true">✕</span>
          </button>
        </div>

        <button class="nav-btn left" type="button" (click)="prev()" aria-label="Previous">
          <span aria-hidden="true">‹</span>
        </button>
        <button class="nav-btn right" type="button" (click)="next()" aria-label="Next">
          <span aria-hidden="true">›</span>
        </button>

        <ng-container *ngIf="activeItem() as active">
          <!-- Image -->
          <img
            *ngIf="active.kind === 'image'"
            class="full"
            [src]="active.fullUrl"
            [alt]="active.alt"
            decoding="async"
          />

          <!-- Video (loaded only when modal opens) -->
          <ng-container *ngIf="active.kind === 'video'">
            <ng-container *ngIf="shouldLoadVideo(); else videoThumb">
              <video
                *ngIf="active.provider !== 'youtube'; else youtubeEmbed"
                class="full"
                controls
                playsinline
                preload="metadata"
                [attr.poster]="active.thumbUrl"
              >
                <source [src]="active.videoUrl" type="video/mp4" />
              </video>

              <ng-template #youtubeEmbed>
                <iframe
                  class="full"
                  [src]="safeEmbedUrl()!"
                  [title]="active.title"
                  loading="lazy"
                  referrerpolicy="strict-origin-when-cross-origin"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen
                ></iframe>
              </ng-template>
            </ng-container>

            <ng-template #videoThumb>
              <img class="full" [src]="active.thumbUrl" [alt]="active.title" />
            </ng-template>
          </ng-container>
        </ng-container>

        <div class="modal-hint" aria-hidden="true">
          <span class="hint-pill">Esc to close</span>
          <span class="hint-pill">← / → to navigate</span>
          <span class="hint-pill mobile-only">Swipe to navigate</span>
        </div>
      </div>
    </div>
  </div>
</section>
