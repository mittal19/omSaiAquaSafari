<section id="gallery" class="gallery">
  <div class="container">
    <header class="header">
      <p class="eyebrow">Gallery</p>
      <h2 class="title">Moments from our Yacht & Cruise Experiences</h2>
      <p class="subtitle">
        Tap any photo/video to view in full. Thumbnails are optimized for fast loading.
      </p>
    </header>

    <!-- ✅ Modern responsive grid (fast) -->
    <div class="grid" role="list">
      <button
        *ngFor="let item of items()"
        class="tile"
        type="button"
        role="listitem"
        (click)="open(item)"
        [attr.aria-label]="item.kind === 'image' ? item.alt : item.title"
      >
        <img
          class="thumb"
          [src]="item.thumbUrl"
          [alt]="item.kind === 'image' ? item.alt : item.title"
          loading="lazy"
          decoding="async"
        />

        <span class="chip" *ngIf="item.kind === 'video'">Video</span>
        <span class="fade"></span>
      </button>
    </div>

    <div class="gallery-footer">
  <button class="btn primary large" type="button" (click)="seeMore()">
    See More Photos & Videos
  </button>
</div>


    <!-- ✅ Lightbox modal -->
    <div class="modal-backdrop" *ngIf="isOpen()" (click)="close()"></div>

    <div class="modal" *ngIf="isOpen()" role="dialog" aria-modal="true">
      <div class="modal-shell">
        <button class="icon-btn" type="button" (click)="close()" aria-label="Close">✕</button>

        <button class="nav-btn left" type="button" (click)="prev()" aria-label="Previous">‹</button>
        <button class="nav-btn right" type="button" (click)="next()" aria-label="Next">›</button>

        <ng-container *ngIf="activeItem() as active">
          <!-- Image -->
          <img
            *ngIf="active.kind === 'image'"
            class="full"
            [src]="active.fullUrl"
            [alt]="active.alt"
            decoding="async"
          />

          <!-- Video (loaded only when modal opens) -->
          <ng-container *ngIf="active.kind === 'video'">
            <ng-container *ngIf="shouldLoadVideo(); else videoThumb">
              <video
                *ngIf="active.provider !== 'youtube'; else youtubeEmbed"
                class="full"
                controls
                playsinline
                preload="metadata"
                [attr.poster]="active.thumbUrl"
              >
                <source [src]="active.videoUrl" type="video/mp4" />
              </video>

              <ng-template #youtubeEmbed>
                <!-- If you use YouTube: store embed URL and load only here -->
                <iframe
                  class="full"
                  [src]="active.videoUrl"
                  title="Video"
                  loading="lazy"
                  referrerpolicy="strict-origin-when-cross-origin"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen
                ></iframe>
              </ng-template>
            </ng-container>

            <ng-template #videoThumb>
              <img class="full" [src]="active.thumbUrl" [alt]="active.title" />
            </ng-template>
          </ng-container>
        </ng-container>
      </div>
    </div>
  </div>
</section>
